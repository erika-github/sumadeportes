<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <title>SumaDeportes - Registro de Pago</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <style>
        /* Estilos adicionales para header, menú y demás secciones */
        .user-container {
            display: flex;
            justify-content: space-between;
            height: auto;
            margin-left: 2%;
            cursor: pointer;
        }

        .user-icon {
            width: 4vw;
            height: 4vw;
            background-color: #f36621;
            color: white;
            font-size: 1.5vw;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            cursor: pointer;
        }

        #img,
        .user-container p {
            position: absolute;
            top: 0px;
            width: auto;
            z-index: 100;
            margin-top: 0.5%;
            box-sizing: border-box;
            right: 10%;
        }

        #user-icon {
            position: absolute;
            top: 0px;
            z-index: 100;
            margin-top: 0.7%;
            box-sizing: border-box;
            right: 5%;
        }

        .user-menu {
            display: none;
            position: absolute;
            right: 1%;
            min-width: 13%;
            max-width: 13%;
            top: 5.4vw;
            background-color: white;
            border-radius: 0.5vw;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
            padding-bottom: 1%;
            z-index: 10000;
        }

        .user-menu-header {
            background-color: #f2f2f2;
            padding: 1.5vw;
            color: #7f7f7f;
            text-align: center;
            font-weight: lighter;
        }

        .user-menu-content {
            padding: 1vw;
            display: flex;
            flex-direction: column;
        }

        .user-menu-content a {
            text-decoration: none;
            color: #7f7f7f;
            padding: 0.7vw;
            text-align: center;
            border-radius: 0.3vw;
            margin-top: 2%;
            transition: background 0.3s ease;
        }

        .user-menu-content a:hover {
            background: #f2f2f2;
        }

        /* Estilos generales */
        .form-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5vw;
            min-width: 65%;
            max-width: 66%;
            margin: auto;
            padding: 1.3%;
            background-color: #fff;
            border-radius: 1vw;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.95vw;
            margin-bottom: 1%;
            margin-top: 1.5%;
            color: #808080;
        }

        .form-group input,
        .form-group select {
            padding: 2.25%;
            font-size: 0.95vw;
            border: 0.1vw solid #ccc;
            border-radius: 0.3vw;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #007bff;
            box-shadow: 0 0 0.5vw rgba(0, 123, 255, 0.5);
            outline: none;
        }

        .submit-container {
            text-align: center;
            margin-top: 3%;
        }

        .submit-container button {
            background-color: #007bff;
            color: white;
            font-size: 1.1vw;
            padding: 0.8vw 2vw;
            border: none;
            border-radius: 5vw;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
            margin: 0 auto;
        }

        .submit-container button:hover {
            background-color: #0056b3;
            transform: translateY(-3px);
        }

        .submit-container button:active {
            background-color: #004085;
            transform: translateY(0);
        }


        /* Secciones ocultas para cada método */
        .payment-section {
            display: none;
            border: 1px solid #ccc;
            padding: 1vw;
            border-radius: 0.5vw;
            margin-bottom: 1.5vw;
        }

        /* Estilos para la selección de método de pago */
        .payment-method {
            border: 1px solid #ccc;
            padding: 1vw;
            border-radius: 0.5vw;
            margin: 1vw auto;
            max-width: 66%;
        }

        .payment-method h2 {
            font-size: 1.2vw;
            margin-bottom: 1vw;
        }

        .payment-method label {
            margin-right: 1vw;
            font-size: 1vw;
        }

        .form-group-inline {
            display: flex;
            gap: 0.5vw;
            /* Reducido espacio entre campos */
            align-items: center;
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        .inline-field {
            display: flex;
            flex-direction: column;
            gap: 0.5vw;
            /* Espacio interno entre etiqueta y campo */
        }

        .inline-field.docType {
            flex: 0 0 25%;
            /* Tipo de documento ocupa el 25% */
        }

        .inline-field.docNumber {
            flex: 0 0 74%;
            /* Número de documento ocupa el 74% */
        }

        .estilo1 {
            padding: 1.50%;
            font-size: 1vw;
            border: 0.1vw solid #ccc;
            border-radius: 0.3vw;
            box-sizing: border-box;
            width: 100%;
        }

        .estilo2 {
            padding: 4%;
            font-size: 1vw;
            border: 0.1vw solid #ccc;
            border-radius: 0.3vw;
            box-sizing: border-box;
            width: 100%;
        }


        .form-group input,
        .form-group select {
            padding: 1.25%;
            font-size: 1vw;
            /* Ajuste en el tamaño de la fuente */
            border: 0.1vw solid #ccc;
            border-radius: 0.3vw;
            box-sizing: border-box;
            width: 100%;
            /* Asegura que los campos ocupen el 100% de su contenedor */
        }


        .form-group-inline .inline-field label {

            font-size: 0.95vw;
            color: #808080;
            margin-top: 1vw
        }

        .error {
            color: red;
            font-size: 0.9vw;
            height: 1vw;
            /* Altura fija para el mensaje de error */
        }

        footer,
        .registro {
            display: none;
        }
    </style>
</head>

<body>
    <div class="header-container">
        <!-- Cintillo -->
        <div style="height: 7vw; position: relative">
            <img id="cintillo" src="img/cintilloMenu.png" alt="Cintillo" />
        </div>
        <!-- Logo -->
        <div class="logoDiv">
            <img id="logo" src="img/logo.png" alt="Logo" onclick="window.location.href='index_autenticado.html'" />
        </div>
        <!-- Imagen de usuario -->
        <div class="user-container">
            <p style="
                  font-size: 1.2vw;
                  margin-top: 2%;
                  right:27%;
                  color: #1535d6;
                  text-decoration: underline;
                " onclick="window.location.href='gestion.html'">
                Gestión
            </p>
            <p style="
                  font-size: 1.2vw;
                  margin-top: 2%;
                  right:10%;
                  color: #1535d6;
                  text-decoration: underline;
                " onclick="window.location.href='inscripcion_eventos_mes.html'">
                Inscripción a Eventos por Mes
            </p>

            <div id="user-icon" class="user-icon" onclick="toggleUserMenu()"></div>
        </div>
    </div>

    <!-- Menú emergente -->
    <div class="user-menu" id="user-menu">
        <div class="user-menu-header">
            <p style="font-size: 1vw" id="userName">Nombre del Usuario</p>
            <p style="font-size: 1vw" id="userRole">Rol del Usuario</p>
        </div>
        <div class="user-menu-content">
            <a href="#" style="font-size: 1vw">Editar Perfil</a>
            <a href="#" style="font-size: 1vw" onclick="logout()">Cerrar Sesión</a>
        </div>
    </div>

    <!-- Aquí iría tu header, menú y demás elementos -->
    <h1 style="text-align: center; margin-top: 5%; margin-bottom: 5%; font-size: 2.5vw; font-weight: lighter;">
        Registro de Pago de Inscripción
    </h1>

    <!-- Selección del método de pago -->
    <div class="payment-method">
        <h2>Seleccione el método que utilizó para efectuar el pago</h2>
        <input type="radio" id="pagoMovilRadio" name="paymentMethod" value="pagoMovil"
            onclick="mostrarSeccion('pagoMovil')">
        <label for="pagoMovilRadio">Pago Móvil</label>
        <span class="error" id="errorPagoMovilRadio"></span>
        <input type="radio" id="transferenciaRadio" name="paymentMethod" value="transferencia"
            onclick="mostrarSeccion('transferencia')">
        <label for="transferenciaRadio">Transferencia Bancaria</label>
        <span class="error" id="errorTransferenciaRadio"></span>
        <input type="radio" id="zelleRadio" name="paymentMethod" value="zelle" onclick="mostrarSeccion('zelle')">
        <label for="zelleRadio">Zelle</label>
        <span class="error" id="errorZelleRadio"></span>
    </div>

    <!-- Formularios específicos según la opción seleccionada -->
    <form class="form-container" id="payment-form">
        <!-- Sección Pago Móvil -->
        <div id="pagoMovilSection" class="payment-section">
            <h3>Pago Móvil</h3>
            <div class="form-group">
                <label for="bank">Banco:</label>
                <select id="bank" name="bank">
                    <option value="">Seleccione una opción</option>
                    <option value="BancoDeVenezuela">0102 - BANCO DE VENEZUELA</option>
                    <option value="100%Banco">0156 - 100% BANCO</option>
                    <option value="BancaAmiga">0172 - BANCAMIGA BANCO UNIVERSAL C.A.</option>
                    <option value="Bancaribe">0114 - BANCARIBE</option>
                    <option value="BancoActivo">0171 - BANCO ACTIVO</option>
                    <option value="BancoAgricolaDeVzla">0166 - BANCO AGRICOLA DE VENEZUELA</option>
                    <option value="BancoCaroni">0128 - BANCO CARONI</option>
                    <option value="BancoDelTesoro">0163 - BANCO DEL TESORO</option>
                    <option value="BancoDigitalDeLosTrabajadores">0175 - BANCO DIGITAL DE LOS TRABAJADORES, BANCO
                        UNIVERSAL</option>
                    <option value="BancoExterior">0175 - BANCO EXTERIOR</option>
                    <option value="BancoFondoComun">0151 - BANCO FONDO COMUN</option>
                    <option value="BancoInternacionalDeDesarrollo">0173 - BANCO INTERNACIONAL DE DESARROLLO</option>
                    <option value="BancoMercantil">0105 - BANCO MERCANTIL</option>
                    <option value="BancoNacionalDeCredito">0191 - BANCO NACIONAL DE CREDITO</option>
                    <option value="BancoPlaza">0138 - BANCO PLAZA</option>
                    <option value="BancoSofitasa">0137 - BANCO SOFITASA</option>
                    <option value="BancoVenezolanoDeCredito">0104 - BANCO VENEZOLANO DE CREDITO</option>
                    <option value="Bancrecer">0168 - BANCRECER</option>
                    <option value="Banesco">0134 - BANESCO</option>
                    <option value="Banfanb">0177 - BANFANB</option>
                    <option value="Bangente">0146 - BANGENTE</option>
                    <option value="Banplus">0174 - BANPLUS</option>
                    <option value="BbvaProvincial">0108 - BBVA PROVINCIAL</option>
                    <option value="DelSurBancoUniversal">0157 - DELSUR BANCO UNIVERSAL</option>
                    <option value="InstMunDeCreditoPopular">0601 - INSTITUTO MUNICIPAL DE CREDITO POPULAR</option>
                    <option value="BancoDigitalMicrofinanciero">0178 - N58 BANCO DIGITAL BANCO MICROFINANCIERO S.A.
                    </option>
                    <option value="R4BancoMicrofinanciero">0169 - R4 BANCO MICROFINANCIERO C.A.</option>
                </select>
                <span class="error" id="errorBank"></span>
            </div>
            <div class="form-group">
                <label for="amount">Monto:</label>
                <input type="text" id="amount" name="amount" oninput="limitarNumeroConDecimales(this)" />
                <span class="error" id="errorAmount"></span>
            </div>
            <div class="form-group">
                <label for="referenceNumber">Número de Referencia:</label>
                <input type="number" id="referenceNumber" name="referenceNumber" />
                <span class="error" id="errorReferenceNumber"></span>
            </div>
            <div class="form-group">
                <label for="phone">Número de Celular (Pago Móvil):</label>
                <input type="text" id="phone" name="phone" />
                <span class="error" id="errorPhone"></span>
            </div>
            <div class="form-group">
                <label for="paymentDate">Fecha de Pago:</label>
                <input type="date" id="paymentDate" name="paymentDate" />
                <span class="error" id="errorPaymentDate"></span>
            </div>
        </div>

        <!-- Sección Transferencia Bancaria -->
        <div id="transferenciaSection" class="payment-section">
            <h3>Transferencia Bancaria</h3>
            <div class="form-group">
                <label for="bankTransfer">Banco:</label>
                <select id="bankTransfer" name="bankTransfer">
                    <option value="">Seleccione una opción</option>
                    <option value="BancoDeVenezuela">0102 - BANCO DE VENEZUELA</option>
                    <option value="100%Banco">0156 - 100% BANCO</option>
                    <option value="BancaAmiga">0172 - BANCAMIGA BANCO UNIVERSAL C.A.</option>
                    <option value="Bancaribe">0114 - BANCARIBE</option>
                    <option value="BancoActivo">0171 - BANCO ACTIVO</option>
                    <option value="BancoAgricolaDeVzla">0166 - BANCO AGRICOLA DE VENEZUELA</option>
                    <option value="BancoCaroni">0128 - BANCO CARONI</option>
                    <option value="BancoDelTesoro">0163 - BANCO DEL TESORO</option>
                    <option value="BancoDigitalDeLosTrabajadores">0175 - BANCO DIGITAL DE LOS TRABAJADORES, BANCO
                        UNIVERSAL</option>
                    <option value="BancoExterior">0175 - BANCO EXTERIOR</option>
                    <option value="BancoFondoComun">0151 - BANCO FONDO COMUN</option>
                    <option value="BancoInternacionalDeDesarrollo">0173 - BANCO INTERNACIONAL DE DESARROLLO</option>
                    <option value="BancoMercantil">0105 - BANCO MERCANTIL</option>
                    <option value="BancoNacionalDeCredito">0191 - BANCO NACIONAL DE CREDITO</option>
                    <option value="BancoPlaza">0138 - BANCO PLAZA</option>
                    <option value="BancoSofitasa">0137 - BANCO SOFITASA</option>
                    <option value="BancoVenezolanoDeCredito">0104 - BANCO VENEZOLANO DE CREDITO</option>
                    <option value="Bancrecer">0168 - BANCRECER</option>
                    <option value="Banesco">0134 - BANESCO</option>
                    <option value="Banfanb">0177 - BANFANB</option>
                    <option value="Bangente">0146 - BANGENTE</option>
                    <option value="Banplus">0174 - BANPLUS</option>
                    <option value="BbvaProvincial">0108 - BBVA PROVINCIAL</option>
                    <option value="DelSurBancoUniversal">0157 - DELSUR BANCO UNIVERSAL</option>
                    <option value="InstMunDeCreditoPopular">0601 - INSTITUTO MUNICIPAL DE CREDITO POPULAR</option>
                    <option value="BancoDigitalMicrofinanciero">0178 - N58 BANCO DIGITAL BANCO MICROFINANCIERO S.A.
                    </option>
                    <option value="R4BancoMicrofinanciero">0169 - R4 BANCO MICROFINANCIERO C.A.</option>
                    <!-- ... otras opciones ... -->
                </select>
                <span class="error" id="errorBankTransfer"></span>
            </div>
            <div class="form-group">
                <label for="amountTransfer">Monto:</label>
                <input type="text" id="amountTransfer" name="amountTransfer"
                    oninput="limitarNumeroConDecimales(this)" />
                <span class="error" id="errorAmountTransfer"></span>
            </div>
            <div class="form-group">
                <label for="originAccount">Cuenta Origen (20 dígitos):</label>
                <input type="text" id="originAccount" name="originAccount" />
                <span class="error" id="errorOriginAccount"></span>
            </div>
            <div class="form-group">
                <label for="DestinationAccount">Cuenta Destino (20 dígitos):</label>
                <input type="text" id="destinationAccount" name="destinationAccount" />
                <span class="error" id="errorDestinationAccount"></span>
            </div>
            <div class="form-group">
                <label for="transferReference">Número de Referencia/Operación:</label>
                <input type="number" id="transferReference" name="transferReference" />
                <span class="error" id="errorTransferReference"></span>
            </div>

            <!-- Agrupación en línea para Tipo y Número de Documento -->
            <div class="form-group-inline">
                <div class="inline-field docType">
                    <label for="docType">Tipo de Documento:</label>
                    <select id="docType" name="docType" class="estilo2">
                        <option value="">Seleccione</option>
                        <option value="V">V</option>
                        <option value="P">P</option>
                        <option value="E">E</option>

                    </select>
                    <span class="error" id="errorDocType"></span>
                </div>


                <div class="inline-field docNumber">
                    <label for="docNumber">Número de Documento:</label>
                    <input type="text" id="docNumber" name="docNumber" class="estilo1" />
                    <span class="error" id="errorDocNumber"></span>
                </div>

            </div>

            <div class="form-group">
                <label for="transferDate">Fecha de la Operación:</label>
                <input type="date" id="transferDate" name="transferDate" />
                <span class="error" id="errorTransferDate"></span>
            </div>
        </div>

        <!-- Sección Zelle -->
        <div id="zelleSection" class="payment-section">
            <h3>Zelle</h3>
            <div class="form-group">
                <label for="zelleEmail">Correo Electrónico asociado a Zelle:</label>
                <input type="email" id="zelleEmail" name="zelleEmail" />
                <span class="error" id="errorZelleEmail"></span>
            </div>
            <div class="form-group">
                <label for="amountZelle">Monto:</label>
                <input type="text" id="amountZelle" name="amountZelle" oninput="limitarNumeroConDecimales(this)" />
                <span class="error" id="errorAmountZelle"></span>
            </div>
            <div class="form-group">
                <label for="referenceZelle">Número de Referencia:</label>
                <input type="number" id="referenceZelle" name="referenceZelle" />
                <span class="error" id="errorReferenceZelle"></span>
            </div>
            <div class="form-group">
                <label for="zelleDate">Fecha de Pago:</label>
                <input type="date" id="zelleDate" name="zelleDate" />
                <span class="error" id="errorZelleDate"></span>
            </div>
        </div>

        <div class="submit-container">
            <button type="submit">Guardar</button>
        </div>
    </form>

    <footer>
        <div id="footer_logo">
            <img src="img/logo_.png" alt="" />
        </div>
        <div id="academia">
            <h2>Academia</h2>
            <p>¿Cursos y horarios?</p>
            <p>¿Dónde encontrarnos?</p>
        </div>
        <div id="informacion">
            <h2>Información</h2>
            <p>Preguntas frecuentes</p>
        </div>
    </footer>

    <div class="registro">
        <div id="linea"></div>
        <div id="creadores">
            <p>
                Suma Deportes, RIF J-00000000-0 Todos los derechos reservados. Powered
                by Lenin Manrique & Erika Díaz
            </p>
        </div>
    </div>

    <script>

        const fieldLabels = {
            bank: "Banco",
            amount: "Monto",
            referenceNumber: "Número de Referencia",
            phone: "Número de Celular",
            paymentDate: "Fecha de Pago",
            amountTransfer: "Monto",
            docType: "Tipo de Documento",
            docNumber: "Número de Documento",
            originAccount: "Cuenta Origen",
            destinationAccount: "Cuenta Destino",
            transferReference: "Número de Referencia/Operación",
            transferDate: "Fecha de la Operación",
            bankTransfer: "Banco",
            zelleEmail: "Correo Electrónico",
            zelleDate: "Fecha de Pago",
            amountZelle: "Monto",
            referenceZelle: "Número de Referencia"
        };

        // Función para cerrar sesión
        var valid = true;
        function logout() {
            sessionStorage.clear();
            window.location.href = "index.html";
        }

        // Función para obtener las iniciales del usuario
        function getInitials(firstName, lastName) {
            if (!firstName || !lastName) return "U";
            return (
                firstName.charAt(0).toUpperCase() + lastName.charAt(0).toUpperCase()
            );
        }

        // Actualiza la información del usuario en el DOM
        function updateUserInfo() {
            const firstName = sessionStorage.getItem("userFirstName") || "Nombre";
            const lastName = sessionStorage.getItem("userLastName") || "Apellido";
            const userRole =
                sessionStorage.getItem("userRole") || "Rol Predeterminado";
            const nameElem = document.getElementById("userName");
            const roleElem = document.getElementById("userRole");
            if (nameElem) nameElem.innerText = `${firstName} ${lastName}`;
            if (roleElem) roleElem.innerText = userRole;
        }

        // Establece el ícono del usuario con iniciales
        function setUserIcon() {
            updateUserInfo();
            const firstName = sessionStorage.getItem("userFirstName");
            const lastName = sessionStorage.getItem("userLastName");
            const userIcon = document.getElementById("user-icon");
            if (userIcon) {
                userIcon.textContent = getInitials(firstName, lastName);
            }
        }

        // Función para mostrar/ocultar el menú del usuario
        function toggleUserMenu() {
            const menu = document.getElementById("user-menu");
            const userIcon = document.getElementById("user-icon");
            if (menu && userIcon) {
                const isVisible = menu.style.display === "block";
                menu.style.display = isVisible ? "none" : "block";
                userIcon.style.backgroundColor = isVisible ? "#F36621" : "#2e3192";
            }
        }

        // Cierra el menú al hacer clic fuera de él
        document.addEventListener("click", (event) => {
            const menu = document.getElementById("user-menu");
            const userIcon = document.getElementById("user-icon");
            const userContainer = document.querySelector(".user-container");
            if (
                menu &&
                userIcon &&
                userContainer &&
                !userContainer.contains(event.target)
            ) {
                menu.style.display = "none";
                userIcon.style.backgroundColor = "#F36621";
            }
        });
        const submitButton = document.querySelector("button[type='submit']");

        document.addEventListener("DOMContentLoaded", function () {

            attachRealTimeValidations();
            setUserIcon();

        });


        // Función para mostrar la sección según el método seleccionado
        function mostrarSeccion(metodo) {
            document.getElementsByClassName("form-container")[0].style.display = "block";
            document.getElementsByClassName("registro")[0].style.display = "block";
            document.querySelector("footer").style.display = "flex";
            // Oculta todas las secciones
            document.getElementById("pagoMovilSection").style.display = "none";
            document.getElementById("transferenciaSection").style.display = "none";
            document.getElementById("zelleSection").style.display = "none";
            // Muestra solo la sección correspondiente
            if (metodo === 'pagoMovil') {
                document.getElementById("pagoMovilSection").style.display = "block";
            } else if (metodo === 'transferencia') {
                document.getElementById("transferenciaSection").style.display = "block";
            } else if (metodo === 'zelle') {
                document.getElementById("zelleSection").style.display = "block";
            }
        }


        // Función que limita número con decimales: 
        function limitarNumeroConDecimales(input) {
            let valor = input.value.replace(',', '.').replace(/[^0-9.]/g, '');
            let partes = valor.split('.');
            if (partes.length > 2) {
                partes = [partes[0], partes[1]];
            }
            if (partes.length === 2) {
                partes[0] = partes[0].slice(0, 10);
                partes[1] = partes[1].slice(0, 2);
                valor = partes[0] + '.' + partes[1];
            } else {
                valor = partes[0].slice(0, 12);
            }
            input.value = valor;

        }

        // Validación de campos según sección visible
        function validateForm() {
            let valid = true;
            // Determinar qué método se ha seleccionado
            const metodo = document.querySelector("input[name='paymentMethod']:checked");
            if (!metodo) {
                Swal.fire({
                    title: "Error",
                    text: "Seleccione un método de pago.",
                    icon: "error",
                    confirmButtonText: "Entendido",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    backdrop: true
                });
                return false;
            }

            const m = metodo.value;


            if (m === "pagoMovil") {

                const fieldsToValidate = {

                    bank: "Banco",
                    amount: "Monto",
                    referenceNumber: "Numero de Referencia",
                    phone: "Número de Celular",
                    paymentDate: "Fecha de Pago"
                };

                Object.entries(fieldsToValidate).forEach(([id, label]) => {

                    if (!validateField(id, label)) {
                        valid = false;
                    }
                    
                });
                return valid;
                  

            } else if (m === "transferencia") {

                const fieldsToValidate = {


                    amountTransfer: "Monto",
                    docType: "Tipo de Documento",
                    docNumber: "Número de Documento",
                    originAccount: "Cuenta Origen",
                    destinationAccount: "Cuenta Destino",
                    transferReference: "Número de Referecia/Operación",
                    transferDate: "Fecha de la Operación",
                    bankTransfer: "Banco",

                };

                Object.entries(fieldsToValidate).forEach(([id, label]) => {
                    if (!validateField(id, label)) {
                        valid = false;
                    }

                    console.log("Valor de validate 2::::" + validateField)
                });
                return valid;

            } if (m === "zelle") {
                const fieldsToValidate = {


                    zelleEmail: "Correo Electrónico",
                    zelleDate: "Fecha de pago",
                    amountZelle: "Monto",
                    referenceZelle: "Número de referencia"
                };

                Object.entries(fieldsToValidate).forEach(([id, label]) => {
                    if (!validateField(id, label)) {
                        valid = false;
                    }

                    console.log("Valor de validate:::: 3" + validateField)
                });
                return valid;
            }

        }


        // Función de validación en tiempo real        

        function attachRealTimeValidations() {

            Object.keys(fieldLabels).forEach((id) => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener("input", function () {
                        validateField(id, fieldLabels[id]);
                    });
                }
            });
        }


        function validateField(id) {

            const input = document.getElementById(id);

            if (!input) {
                console.error(`No se encontró el input con ID: ${id}`);
                return false;
            }

            const capitalizedId = id.charAt(0).toUpperCase() + id.slice(1);
            const errorSpan = document.getElementById(`error${capitalizedId}`);
            if (!errorSpan) {
                console.error(`No se encontró el span con ID: error${capitalizedId}`);
                return false;
            }

            const fieldName = fieldLabels[id] || id;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const phoneRegex = /^(0412|0414|0416|0424|0426)-(?!0{7})\d{7}$/;

            // 1) Fecha
            /*if (input.type === "date") {

                const inputDate = new Date(input.value.trim());
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                    return false

                } else if (inputDate > today) {
                    errorSpan.textContent = `${fieldName} no puede ser mayor a la fecha actual.`;
                    return false
                } else {
                    errorSpan.textContent = "";
                }
                errorSpan.style.color = "red";
                return;
            }

            // 2) Email / Zelle
            if (input.type === "email" || id === "zelleEmail") {
                // Limitar longitud a 100 caracteres
                if (input.value.length > 100) {
                    input.value = input.value.slice(0, 100);
                }
                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                } else if (!emailRegex.test(input.value)) {
                    errorSpan.textContent = `Ingrese un ${fieldName} válido.`;
                } else {
                    errorSpan.textContent = "";
                }
                errorSpan.style.color = "red";
                return;
            }

            // 3) Teléfono / Celular (formato 04xx-xxxxxxx → 12 caracteres)
            if (id === "phone") {
                // Extrae dígitos
                let digits = input.value.replace(/\D/g, "");
                // Inserta guion tras 4 dígitos
                if (digits.length > 4) {
                    digits = digits.slice(0, 4) + "-" + digits.slice(4);
                }
                // Limita a 12 caracteres
                input.value = digits.slice(0, 12);

                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                } else if (!phoneRegex.test(input.value)) {
                    errorSpan.textContent = `Formato inválido. Debe ser 04xx-xxxxxxx.`;
                } else {
                    errorSpan.textContent = "";
                }
                errorSpan.style.color = "red";
                return;
            }

            // 4) Número de Documento: solo dígitos, max 10, no puede ser "0"
            if (id === "docNumber") {

                input.value = input.value.replace(/\D/g, "").slice(0, 10);
                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio`;

                } else if (/^0+$/.test(input.value)) {
                    errorSpan.textContent = `${fieldName} no puede ser cero.`;

                } else if (input.value.length < 7) {

                    errorSpan.textContent = `${fieldName} debe tener al menos 7 dígitos.`;
                } else {
                    errorSpan.textContent = "";
                }
                errorSpan.style.color = "red";
                return;
            }

            // 5) Cuenta Origen / Cuenta Destino: solo dígitos, exactamente 20
            if (id === "originAccount" || id === "destinationAccount") {

                input.value = input.value.replace(/\D/g, "").slice(0, 20);
                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                } else if (input.value.length < 20) {
                    errorSpan.textContent = `${fieldName} debe tener exactamente 20 dígitos.`;

                } else if (/^0+$/.test(input.value)) {
                    errorSpan.textContent = `${fieldName} no puede ser cero.`;

                } else {
                    errorSpan.textContent = "";
                }
                errorSpan.style.color = "red";
                return;
            }

            // 6) Referencia de Transferencia: solo dígitos, hasta 30
            if (id === "transferReference" || id === "referenceNumber" || id === "referenceZelle") {

                input.value = input.value.replace(/\D/g, "").slice(0, 30);
                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;

                } else if (/^0+$/.test(input.value)) {
                    errorSpan.textContent = `${fieldName} no puede ser cero.`;

                } else {
                    errorSpan.textContent = "";
                }
                errorSpan.style.color = "red";
                return;
            }

            //7) validacion de montos

            if (id === "amount" || id === "amountTransfer" || id === "amountZelle") {

                const monto = parseFloat(input.value);

                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                } else if (isNaN(monto) || monto <= 0) {
                    errorSpan.textContent = `${fieldName} debe ser mayor a cero.`;
                } else {
                    errorSpan.textContent = "";
                }
                errorSpan.style.color = "red";
                return
            }

            // 8) Caso general: obligatorio (sin validación de longitud específica)
            input.value = input.value.trim();
            if (!input.value) {
                errorSpan.textContent = `${fieldName} es obligatorio.`;
            } else {
                errorSpan.textContent = "";
            }
            errorSpan.style.color = "red";
            return*/

            // 1) Fecha
            if (input.type === "date") {
                const inputDate = new Date(input.value.trim());
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                    errorSpan.style.color = "red";
                    return false;
                } else if (inputDate > today) {
                    errorSpan.textContent = `${fieldName} no puede ser mayor a la fecha actual.`;
                    errorSpan.style.color = "red";
                    return false;
                } else {
                    errorSpan.textContent = "";
                    return true;
                }
            }

            // 2) Email / Zelle
            if (input.type === "email" || id === "zelleEmail") {
                if (input.value.length > 100) {
                    input.value = input.value.slice(0, 100);
                }
                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                    errorSpan.style.color = "red";
                    return false;
                } else if (!emailRegex.test(input.value)) {
                    errorSpan.textContent = `Ingrese un ${fieldName} válido.`;
                    errorSpan.style.color = "red";
                    return false;
                } else {
                    errorSpan.textContent = "";
                    return true;
                }
            }

            // 3) Teléfono / Celular
            if (id === "phone") {
                let digits = input.value.replace(/\D/g, "");
                if (digits.length > 4) {
                    digits = digits.slice(0, 4) + "-" + digits.slice(4);
                }
                input.value = digits.slice(0, 12);

                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                    errorSpan.style.color = "red";
                    return false;
                } else if (!phoneRegex.test(input.value)) {
                    errorSpan.textContent = `Formato inválido. Debe ser 04xx-xxxxxxx.`;
                    errorSpan.style.color = "red";
                    return false;
                } else {
                    errorSpan.textContent = "";
                    return true;
                }
            }

            // 4) Número de Documento
            if (id === "docNumber") {
                input.value = input.value.replace(/\D/g, "").slice(0, 10);
                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio`;
                    errorSpan.style.color = "red";
                    return false;
                } else if (/^0+$/.test(input.value)) {
                    errorSpan.textContent = `${fieldName} no puede ser cero.`;
                    errorSpan.style.color = "red";
                    return false;
                } else if (input.value.length < 7) {
                    errorSpan.textContent = `${fieldName} debe tener al menos 7 dígitos.`;
                    errorSpan.style.color = "red";
                    return false;
                } else {
                    errorSpan.textContent = "";
                    return true;
                }
            }

            // 5) Cuenta Origen / Cuenta Destino
            if (id === "originAccount" || id === "destinationAccount") {
                input.value = input.value.replace(/\D/g, "").slice(0, 20);
                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                    errorSpan.style.color = "red";
                    return false;
                } else if (input.value.length < 20) {
                    errorSpan.textContent = `${fieldName} debe tener exactamente 20 dígitos.`;
                    errorSpan.style.color = "red";
                    return false;
                } else if (/^0+$/.test(input.value)) {
                    errorSpan.textContent = `${fieldName} no puede ser cero.`;
                    errorSpan.style.color = "red";
                    return false;
                } else {
                    errorSpan.textContent = "";
                    return true;
                }
            }

            // 6) Referencia de Transferencia
            if (id === "transferReference" || id === "referenceNumber" || id === "referenceZelle") {
                input.value = input.value.replace(/\D/g, "").slice(0, 30);
                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                    errorSpan.style.color = "red";
                    return false;
                } else if (/^0+$/.test(input.value)) {
                    errorSpan.textContent = `${fieldName} no puede ser cero.`;
                    errorSpan.style.color = "red";
                    return false;
                } else {
                    errorSpan.textContent = "";
                    return true;
                }
            }

            // 7) Validación de Montos
            if (id === "amount" || id === "amountTransfer" || id === "amountZelle") {
                const monto = parseFloat(input.value);
                if (!input.value) {
                    errorSpan.textContent = `${fieldName} es obligatorio.`;
                    errorSpan.style.color = "red";
                    return false;
                } else if (isNaN(monto) || monto <= 0) {
                    errorSpan.textContent = `${fieldName} debe ser mayor a cero.`;
                    errorSpan.style.color = "red";
                    return false;
                } else {
                    errorSpan.textContent = "";
                    return true;
                }
            }

            // 8) Caso general
            input.value = input.value.trim();
            if (!input.value) {
                errorSpan.textContent = `${fieldName} es obligatorio.`;
                errorSpan.style.color = "red";
                return false;
            } else {
                errorSpan.textContent = "";
                return true;
            }
        }

        // Simulación del llamado al servicio (para pruebas)
        /*async function simularEnvio(formData) {
            // Se simula una respuesta exitosa con código 201 o error con otro código
            return await new Promise((resolve) => {
                setTimeout(() => {
                    resolve({
                        code: "201", // Cambia a "409" para simular conflicto o a otro valor para error
                        message: "Pago registrado correctamente."
                    });
                }, 1000);
            });
        }*/

        // Listener para el envío del formulario
        document.getElementById("payment-form").addEventListener("submit", async function (event) {
            event.preventDefault();
            if (!validateForm()) {
                Swal.fire({
                    title: "Error",
                    text: "Corrija los errores en el formulario.",
                    icon: "error",
                    confirmButtonText: "Entendido",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    backdrop: true
                });
                return;
            }
            submitButton.disabled = true;

            // Se construye el objeto de datos a enviar basado en el método seleccionado
            const metodoSeleccionado = document.querySelector("input[name='paymentMethod']:checked").value;
            let requestData = { paymentMedium: metodoSeleccionado };

            if (metodoSeleccionado === "pagoMovil") {
                requestData = {
                    ...requestData,
                    /*bank: document.getElementById("bank").value,
                    amount: document.getElementById("amount").value,
                    referenceNumber: document.getElementById("referenceNumber").value,
                    phone: document.getElementById("phone").value,
                    paymentDate: document.getElementById("paymentDate").value*/
                    orgBank: document.getElementById("bank").value,
                    paymentAmount: document.getElementById("amount").value,
                    paymentReference: document.getElementById("referenceNumber").value,
                    paymentDate: document.getElementById("paymentDate").value,
                    celNumber: document.getElementById("phone").value
                };
            } else if (metodoSeleccionado === "transferencia") {
                requestData = {
                    ...requestData,
                    /*bank: document.getElementById("bankTransfer").value,
                    amount: document.getElementById("amountTransfer").value,
                    originAccount: document.getElementById("originAccount").value,
                    destinationAccount: document.getElementById("destinationAccount").value,
                    transferReference: document.getElementById("transferReference").value,
                    docType: document.getElementById("docType").value,
                    docNumber: document.getElementById("docNumber").value,
                    transferDate: document.getElementById("transferDate").value*/

                    orgBank: document.getElementById("bankTransfer").value,
                    paymentAmount: document.getElementById("amountTransfer").value,
                    orgAccount: document.getElementById("originAccount").value,
                    destAccount: document.getElementById("destinationAccount").value,
                    paymentReference: document.getElementById("transferReference").value,
                    docType: document.getElementById("docType").value,
                    docNumber: document.getElementById("docNumber").value,
                    paymentDate: document.getElementById("transferDate").value

                };
            } else if (metodoSeleccionado === "zelle") {
                requestData = {
                    ...requestData,
                    /*zelleEmail: document.getElementById("zelleEmail").value,
                    amount: document.getElementById("amountZelle").value,
                    referenceNumber: document.getElementById("referenceZelle").value,
                    paymentDate: document.getElementById("zelleDate").value*/
                    email: document.getElementById("zelleEmail").value,
                    paymentAmount: document.getElementById("amountZelle").value,
                    paymentReference: document.getElementById("referenceZelle").value,
                    paymentDate: document.getElementById("zelleDate").value

                };
            }

            try {
                const response = await fetch("https://c986-44-201-249-73.ngrok-free.app/payments/send", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(requestData)
                });

                const responseData = await response.json();

                if (response.status === 201) {
                    let mes = sessionStorage.getItem("month") || "";
                    let anio = sessionStorage.getItem("year") || "";

                    await Swal.fire({
                        title: "Registro exitoso",
                        text: responseData.message || "El registro fue creado correctamente.",
                        icon: "success",
                        confirmButtonText: "Aceptar",
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        backdrop: true
                    });

                    window.location.href = `calendario_inscripcion_eventos.html?mes=${mes}&anio=${anio}`;

                } else if (response.status === 409) {
                    await Swal.fire({
                        title: "Advertencia",
                        text: responseData.message || "Conflicto: ya existe un registro similar.",
                        icon: "warning",
                        confirmButtonText: "Intentar nuevamente",
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        backdrop: true
                    });
                } else {
                    throw new Error(responseData.message || "Ocurrió un error inesperado.");
                }
            } catch (error) {
                console.error("Error:", error);
                Swal.fire({
                    title: "Error",
                    text: error.message || "No se pudo conectar con el servidor.",
                    icon: "error",
                    confirmButtonText: "Intentar nuevamente",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    backdrop: true
                });
            } finally {
                submitButton.disabled = false;
            }
        });
    </script>
</body>

</html>